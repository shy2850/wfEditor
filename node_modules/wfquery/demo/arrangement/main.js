!function(e){function n(n){for(var o=0;o<n.length;o++){if(!/\bimage\b/.test(n[o].type))return alert("文件必须为图片"),!1;!function(n){var o=new FileReader;o.onload=function(n){t.append(e('<li class="item"><img src="'+n.target.result+'" alt="3" /></li>'))},o.readAsDataURL(n)}(n[o])}}var t=e("#main-screen"),o=e("#files"),i=(document.createElement("form"),e('<div class="edit-holder" style="display:none" tabindex="2" title="1.拖拽改变图片位置;\n2.滚轮改变图片大小;\n3.del/backspace键删除;\n4.点击select调整大小。"></div>'));i.html('<label>大小:</label><select name="size">    <option value="size-1-1">1:1</option>    <option value="size-1_5-1">1.5:1</option>    <option value="size-2-2">2:2</option>    <option value="size-3-1">3:1</option>    <option value="size-3-2" selected>3:2[默认]</option>    <option value="size-3-3">3:3</option>    <option value="size-6-4">6:4</option></select>'),e(document.body).append(i),e(document).on("dragenter dragover drop dragleave",function(e){e.preventDefault()}),t.on("drop",function(e){e.preventDefault();var t=e.dataTransfer.files;return 0==t.length?!1:void n(t)}),o.on("change",function(){n(this.files)});var l=null;i.refresh=function(){i.css({marginTop:window.scrollY}),l&&i.css(l.parentNode.getBoundingClientRect()).show().trigger("focus")},e(window).on("resize",i.refresh),t.on("dblclick",".item",function(){l=this.children[0];var e=l.parentNode.className.match(/size[\-\w]+/);a.val(e?e[0]:"size-3-2"),i.refresh()}).on("click",".item",function(){i.hide(),l=null}),i.on("dblclick",function(){i.hide(),l=null});var a=i.children("select[name=size]");a.on("change",function(){l.parentNode.className="item "+this.value,i.refresh()});var r=i.children("select[name=margin]");r.on("change",function(){l.parentNode.classList.add(this.value),i.refresh()}),i.on("keyup",function(n){(8===n.keyCode||46===n.keyCode)&&(e(l.parentNode).remove(),i.hide(),l=null,n.preventDefault(),n.stopPropagation())}),i.on("mousewheel",function(e){e.preventDefault(),e.stopPropagation();var n=parseInt(l.style.width||"100%");e.wheelDelta>0?n+=5:n-=5,l.style.width=n+"%"});var s=null;i.on("mousedown",function(e){return s={left:parseFloat(l.style.left)||0,top:parseFloat(l.style.top)||0,e:{x:e.x,y:e.y}},!1}).on("mousemove",function(n){var t;(t=s)&&e(l).css({left:t.left+n.x-t.e.x+"px",top:t.top+n.y-t.e.y+"px"})}).on("mouseup mouseout mouseleave",function(){return s=null,!1});var u=null;t.on("dragstart",".item",function(){u=this,i.hide()}).on("drop",".item",function(){if(this!==u){var e=t.children();e.indexOf(this)>e.indexOf(u)?this.nextElementSibling?this.parentNode.insertBefore(u,this.nextElementSibling):this.parentNode.appendChild(u):this.parentNode.insertBefore(u,this)}})}(wfQuery);