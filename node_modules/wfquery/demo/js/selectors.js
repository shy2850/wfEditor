!function(t){function e(t,e,n){e=n||e;var a=e?"<option value=''>"+e+"</option>":"<option value=''>请选择</option>";if(!t)return a;var r=a;for(i in t)if("string"==typeof t[i]||"number"==typeof t[i])r+="<option value='"+t[i]+"'>"+i+"</option>";else{var s=i,l=i,o=i.split("_");2===o.length&&(s=o[0],l=o[1]),r+="<option value='"+l+"'>"+s+"</option>"}return r}function n(t,e){function i(t,e,i,n){var a=0,r={},s=n?parseInt(n):9999;switch(e){case 0:case 2:case 4:case 6:case 7:case 9:case 11:a=31;break;case 3:case 5:case 8:case 10:a=30;break;case 1:a=t%4==0&&t%100!=0||t%400==0?29:28;break;default:a=0}a=a>s?s:a;for(var l=i;a>=l;l++)r[l+"日"]=t+"-"+(e+1)+"-"+l;return r}var n={};e=e||new Date;for(var a=e.getFullYear();a>=t.getFullYear();a--){for(var r={},s=a==t.getFullYear()?t.getMonth():0,l=a==e.getFullYear()?e.getMonth():11,o=s;l>=o;o++){var h=a==t.getFullYear()&&o==t.getMonth()?t.getDate():1,c=a==e.getFullYear()&&o==e.getMonth()?e.getDate():31;r[o+1+"月_"+a+"-"+(o+1)]=i(a,o,h,c)}n[a+"年"]=r}return n}var a={options:{o:null,selectors:null,selectorModel:{},next:t("<span></span>"),withDefault:"请选择",hiddenEmpty:!0,brancheValue:!1,devide:"_",chainSpliter:"$",chainFirst:"$$"},_create:function(i,n){var a=this,r=t.extend(a.options,i),s=r.withDefault,l=r.chainSpliter,o=r.hiddenEmpty,h=r.next,c=r.brancheValue,p=r.o,u={},v={};p&&(this._reverseMap(p,"",u,v),this._sumSelectors(u),n.each(function(){var i=0;t(this).hide().after(h&&h instanceof t&&1===h.length?r.next.clone().removeAttr("id"):t("<span></span>"));for(var n=t(this).next().html("");i<a.options.selectors.length;){var f=t("<select>"+e(null,s,a.options.selectors[i].defaultOption)+"</select>").attr(a.options.selectors[i]);n.append(f),i++}var d=t(this),g=(t(this).val(),n.children().first());g.html(e(p,s,g.attr("defaultOption"))),t(this).data("selectData",{o:p,valueMap:u,optionMap:v,withDefault:s,chainSpliter:l,hiddenEmpty:o}),n.on("change","select",function(){var i=t(this).next();t(this).nextAll().each(function(){t(this).html(e(null,s,t(this).attr("defaultOption")))}),a.options.hiddenEmpty&&(t(this).nextAll().hide(),t(this).val()&&v[t(this).val()]&&t(this).next().show()),i.length&&i.html(e(v[t(this).val()],s,i.attr("defaultOption"))),d.val(t(this).val()).attr("value",t(this).val()).change(),!c&&v[t(this).val()]&&d.val("").attr("value","").change()}),t(this).selectValue(t(this).val())}))},_sumSelectors:function(t){var e=this.options,i=e.selectors,n=e.selectorModel;if(i&&i.length);else{var a=0;for(key in t){var r=t[key].split(e.chainSpliter).length;r>a&&(a=r)}e.selectors=new Array;for(var s=0;a-2>s;s++)e.selectors[s]=n}},_reverseMap:function(t,e,n,a){var e=e||"",n=n||{},a=a||{},r=e.split(this.options.chainSpliter).pop();t instanceof Array&&(t=a[r]=this._arrayToJson(a[r],this.options.devide));for(i in t)if("string"==typeof t[i]||"number"==typeof t[i])n[t[i]]=e+this.options.chainSpliter+t[i]+this.options.chainSpliter+i,n[this.options.chainFirst]=n[this.options.chainFirst]||n[t[i]];else{var s=i,l=i.split(this.options.devide);2===l.length?(n[l[1]]=e+this.options.chainSpliter+l[1]+this.options.chainSpliter+l[0],s=l[1],a[s]=t[i]):a[i]=t[i],this._reverseMap(t[i],e+this.options.chainSpliter+s,n,a)}},_arrayToJson:function(t,e){var i={};for(var n in t)if("string"==typeof t[n]){var a=t[n].split(e);a.push(a[0]),i[a[0]]=a[1]}return i}};t.fn.extend({selectors:function(t){return t.beginDate&&(t.o=t.o||n(t.beginDate,t.endDate)),a._create(t,this),this},selectValue:function(i){return void 0===i?t(this).val():(t(this).val(i).attr("value",i),t(this).each(function(){var n=t(this),a=n.data("selectData");if(a){var r=(a.o,a.valueMap),s=a.optionMap;withDefault=a.withDefault,hiddenEmpty=a.hiddenEmpty,chainSpliter=a.chainSpliter;var l=n.next().children().first(),o="";i&&r[i]?o=r[i]:l.children().removeAttr("selected").first().attr("selected",!0).select();var h=o.split(chainSpliter);l.children("option[value='"+(h[1]||"")+"']").attr("selected",!0),n.next().children().each(function(i){if(next=t(this).next().show(),next.length){next.html(e(s[h[i+1]],withDefault,next.attr("defaultOption"))),hiddenEmpty&&1===next.children().length&&next.hide();try{next.children("option[value='"+(h[i+2]||"")+"']").attr("selected",!0)}catch(n){}}})}}))}})}(wfQuery);